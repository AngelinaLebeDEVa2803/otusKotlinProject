### Архитектурные решения (ADR) для Desk-Sharing приложения SmartOffice

1.  **ADR-001: Выбор архитектуры реального времени для отображения занятости мест**
    *   **Проблема:** Как эффективно синхронизировать состояние бронирования (кто, где, когда) между всеми клиентами в реальном времени?
    *   **Варианты:** REST API с периодическим опросом (polling), Server-Sent Events (SSE), WebSockets, MQTT.
    *   **Решение:** **WebSockets** (например, с Socket.IO или WS).
    *   **Обоснование:** Обеспечивает двустороннюю мгновенную коммуникацию. При бронировании сервер может мгновенно "протолкнуть" (push) обновление карты всем подключенным клиентам в данном офисе, что критически важно для избежания конфликтов.

2.  **ADR-002: Стратегия интеграции с корпоративной системой аутентификации**
    *   **Проблема:** Как управлять пользователями и их аутентификацией, не создавая еще одну базу паролей?
    *   **Варианты:** Самостоятельная разработка, интеграция с Active Directory через LDAP, использование Identity Provider (IdP) по стандарту OAuth 2.1 / OIDC (например, Keycloak).
    *   **Решение:** **Интеграция с Keycloak** в качестве OIDC-провайдера.
    *   **Обоснование:** Keycloak выступает абстракцией над AD/LDAP, предоставляя современный, стандартизированный и безопасный протокол (OIDC). Это избавляет приложение от хранения чувствительных данных, обеспечивает Single Sign-On (SSO) и упрощает управление ролями (RBAC).

3.  **ADR-003: Выбор технологии для интерактивной карты офиса**
    *   **Проблема:** Как реализовать интерактивную, масштабируемую и удобную для администрирования карту офиса?
    *   **Варианты:** Статические растровые изображения (PNG, JPG), векторная графика (SVG), кастомная реализация на Canvas, использование специализированных картографических библиотек (Leaflet, OpenLayers, Google Maps API).
    *   **Решение:** **Векторная графика (SVG)** для статических планов этажей и **Leaflet** с кастомными слоями для интерактива.
    *   **Обоснование:** SVG легковесен, масштабируется без потерь качества и легко поддается программатическому изменению (изменение цвета мест). Leaflet предоставляет готовые инструменты для работы с координатами, зумами и слоями, что дешевле и проще кастомной разработки под Google Maps API.

4.  **ADR-004: Подход к офлайн-работе и конфликтам бронирования**
    *   **Проблема:** Как быть, если связь у пользователя пропала в момент бронирования? Как разрешить ситуацию, когда два пользователя пытаются забронировать одно и то же место?
    *   **Варианты:** Оптимистичная блокировка (optimistic locking), пессимистичная блокировка (pessimistic locking), разрешение конфликтов на стороне клиента.
    *   **Решение:** **Оптимистичная блокировка на основе временных меток (timestamp)** или **версий сущности (versioning)**.
    *   **Обоснование:** Пессимистичная блокировка (полная блокировка места на время бронирования) создает плохой пользовательский опыт. Оптимистичный подход предполагает, что конфликты редки. Сервер проверяет, не изменилось ли состояние места с момента его загрузки клиентом. В случае конфликта пользователю предлагается обновить карту и выбрать другое место.

5.  **ADR-005: Стратегия синхронизации с календарями (Google Calendar, Outlook)**
    *   **Проблема:** Как надежно и асинхронно синхронизировать бронирования с внешними календарными системами?
    *   **Варианты:** Синхронные вызовы API календаря во время бронирования, асинхронная обработка через очередь сообщений (message queue).
    *   **Решение:** **Асинхронная обработка через очередь задач (например, RabbitMQ, Redis Queue, SQS)**.
    *   **Обоснование:** Синхронный вызов API Google/Microsoft во время бронирования создает единую точку отказа и увеличивает время отклика для пользователя. Асинхронный подход через очередь позволяет надежно обработать запрос, повторить его в случае сбоя API календаря и быстро ответить пользователю, что бронь принята.

6.  **ADR-006: Выбор базы данных для хранения состояния бронирований**
    *   **Проблема:** Какая БД лучше подходит для частых записей (бронирований) и сложных выборок (история броней, отчеты по использованию)?
    *   **Варианты:** Документоориентированная NoSQL (MongoDB), Реляционная SQL (PostgreSQL), Временные ряды (TimescaleDB).
    *   **Решение:** **Реляционная база данных (PostgreSQL)**.
    *   **Обоснование:** Данные о бронированиях структурированы и требуют целостности (ACID). Сложные отчеты и аналитика по использованию office space удобно пишутся на SQL. Для сценариев временных рядов (например, мониторинг занятости) можно использовать расширение TimescaleDB для PostgreSQL.
