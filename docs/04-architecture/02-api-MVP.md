# API Desk-Sharing приложения SmartOffice, упрощенный вариант

Для MVP будем считать, что система работает в рамках определенного здания и определенного филиала (сущности Filial и Building не рассматриваем).
Апи для просмотра своей команды и аналитики также не рассматриваем.

### 1. Сущности

**Этаж (Floor)**

| Поле | Тип | Бизнес-описание | Пример значения |
| :--- | :--- | :--- | :--- |
| `floorId` | string | ID этажа | `"floor_2"` |
| `name` | string | Человекочитаемое обозначение этажа | `"Этаж 2"` |
| `floorMap` | file | Изображение/карта этажа (опционально) | `first_floor_picture.png` |

**Помещение (Room)**

| Поле | Тип | Бизнес-описание | Пример значения |
| :--- | :--- | :--- | :--- |
| `roomId` | string | ID помещения | `"room_418"` |
| `name` | string | Человекочитаемое обозначение помещения | `"Кабинет 418"` |
| `type` | string | Тип: `"coworking"`, `"meeting_room"`, `"coffee_point"` | `"meeting_room"` |
| `capacity` | integer | Вместимость для переговорок | `5` |
| `floorId` | string | ID этажа, к которому принадлежит помещение | `"floor_2"` |
| `coordinates` | object | Координаты на карте этажа (`x`, `y`) | `{ "x": 150, "y": 320 }` |
| `roomMap` | file | Изображение/карта помещения (опционально) | `cab_picture.png` |

**Рабочее место (Workspace)**

| Поле | Тип | Бизнес-описание | Пример значения |
| :--- | :--- | :--- | :--- |
| `workspaceId` | string | Уникальный идентификатор места | `"ws_floor2_a205"` |
| `name` | string | Человекочитаемое название места | `"А-205"` |
| `floorId` | string | ID этажа, на котором находится место | `"floor_2"` |
| `roomId` | string | ID помещения, в котором находится место | `"room_418"` |
| `coordinates` | object | Координаты на карте помещения (`x`, `y`) | `{ "x": 1, "y": 3 }` |
| `attributes` | string[] | Список атрибутов места | `["monitor", "window", "power_outlet"]` |

**Бронирование (Booking)**

| Поле | Тип | Бизнес-описание | Пример значения |
| :--- | :--- | :--- | :--- |
| `bookingId` | string | Уникальный идентификатор брони | `"book_abc123"` |
| `userId` | string | ID пользователя, создавшего бронь | `"user_789"` |
| `floorId` | string | ID этажа, на котором находится место | `"floor_2"` |
| `roomId` | string | ID помещения, в котором находится место | `"room_418"` |
| `bookingType` | string | Тип брони (рабочее место или переговорка: `"workspace"`, `"meeting_room"`) | `"workspace"` |
| `workspaceId` | string | ID забронированного места (при bookingType = `"workspace"`) | `"ws_floor2_a205"` |
| `startTime` | ISO 8601 | Дата и время начала брони | `"2024-09-20T09:00:00Z"` |
| `endTime` | ISO 8601 | Дата и время окончания брони | `"2024-09-20T17:00:00Z"` |
| `status` | string | Статус: `"active"`, `"cancelled"`, `"completed"` | `"active"` |

### 2. Бизнес-функции (методы)

**Управление сущностями офиса. Сервис EditOffice - для администраторов офиса**

Этажи:

1.  **`POST /api/v1/floors`** - Внесение нового этажа в базу
    *   *Ограничения:* floorId должен быть уникальным.
    *   *Тело запроса:* `{ floorId: "floor_2", name: "Этаж 2" }`

2.  **`GET /api/v1/floors/{floorId}`** - Получение информации об этаже

3.  **`GET /api/v1/floors`** - Получение списка всех этажей

4.  **`PATCH /api/v1/floors/{floorId}`** - Обновление информации об этаже

5.  **`DELETE /api/v1/floors/{floorId}`** - Удаление этажа из базы
    *   *Бизнес-правило:* Все привязанные к этому этажу рабочие места и бронирования удалятся каскадно

Помещения:

6.  **`POST /api/v1/rooms`** - Внесение нового помещения в базу
    *   *Ограничения:* floorId, должны существовать. roomId должен быть уникальным.
    *   *Тело запроса:* `{ roomId: "room_418", name: "Кабинет 418", type: "coworking", floorId: "floor_2", name: "Этаж 2", coordinates: { "x": 150, "y": 320 } }`

7.  **`GET /api/v1/rooms/{roomId}`** - Получение информации о помещении

8.  **`GET /api/v1/rooms`** - Получение списка всех помещений на заданном этаже
    *   *Параметры:* `?floorId=floor_2`

9.  **`PATCH /api/v1/rooms/{roomId}`** - Обновление информации о помещении

10. **`DELETE /api/v1/rooms/{roomId}`** - Удаление помещения из базы
    *   *Бизнес-правило:* Все привязанные к этому помещению рабочие места и бронирования удалятся каскадно

Рабочие места:

11. **`POST /api/v1/workspaces`** - Внесение нового рабочего места в базу
    *   *Ограничения:* floorId и roomId должны существовать. Тип помещения у заданного roomId должен быть type = "coworking"
    *   *Тело запроса:* `{ workspaceId: "ws_floor2_a205", name: "А-205", roomId: "room_418", floorId: "floor_2", coordinates: { "x": 1, "y": 3 }, attributes: ["monitor", "window", "power_outlet"] }`

12. **`GET /api/v1/workspaces/{workspaceId}`** - Получение информации о рабочем месте

13. **`GET /api/v1/workspaces`** - Получение списка всех мест в заданных этаже и помещении
    *   *Параметры:* `?floorId=floor_2&roomId=room_418`

14. **`PATCH /api/v1/workspaces/{workspaceId}`** - Обновление информации о рабочем месте

15. **`DELETE /api/v1/workspaces/{workspaceId}`** - Удаление места из базы
    *   *Бизнес-правило:* Все привязанные к этому месту бронирования удалятся каскадно

**Управление бронированиями**

16. **`POST /api/v1/bookings`** - Создание нового бронирования
    *   *Бизнес-правило:* Пользователь не может забронировать уже занятое место на выбранный промежуток времени. У заданного объекта roomId должен быть тип coworking для брони рабочего места и в параметре workspaceId передан существующий идентификатор места. Для брони переговорки у roomId должен быть тип meeting_room.
    *   *Ограничения:* Максимум 3 активных брони на пользователя вперед.
    *   *Тело запроса:* `{ userId: "123", floorId: "floor_2", roomId: "room_418", bookingType: "workspace", workspaceId: "ws_floor2_a205", startTime: "2024-09-20T09:00:00Z", endTime: "2024-09-20T18:00:00Z" }`

17. **`GET /api/v1/bookings/{bookingId}`** - Получение информации о бронировании

18. **`GET /api/v1/bookings`** - Получение списка своих бронирований
    *   *Параметры:* `?userId=user_789&date=2024-09-20`
    *   *Бизнес-логика:* Возвращает бронирования пользователя на указанную дату.

19. **`PATCH /api/v1/bookings/{bookingId}`** - Обновление бронирования (например, изменение времени)
    *   *Бизнес-правило:* Изменение возможно не позднее 1 часа до начала брони.

20. **`DELETE /api/v1/bookings/{bookingId}`** - Отмена бронирования
    *   *Бизнес-правило:* Отмена возможна в любое время до начала брони.

**Поиск и доступность**
      
21. **`GET /api/v1/rooms/availability`** - Поиск свободных переговорок и отображение броней
    *   *Бизнес-логика:* Возвращает список помещений на этаже и их статус (для переговорок - сводобен или занят и кем занят) на указанный промежуток времени.
    *   *Параметры:* `?floorId=floor_2&startTime=2024-09-20T09:00:00Z&endTime=2024-09-20T18:00:00Z&capacityFrom=5`
    *   *Фильтры:* По этажу, дате/времени, вместимости переговорных.
      
22. **`GET /api/v1/workspaces/availability`** - Поиск свободных мест и отображение броней
    *   *Бизнес-логика:* Возвращает список мест и их статус (сводобен или занят и кем занят) на указанный промежуток времени.
    *   *Параметры:* `?floorId=floor_2&roomId=room_418&startTime=2024-09-20T09:00:00Z&endTime=2024-09-20T18:00:00Z&attributes=monitor`
    *   *Фильтры:* По кабинету, дате/времени, атрибутам места.

23. **`GET /api/v1/rooms/{roomId}/availability`** - Проверка доступности конкретного помещения (для переговорок)
    *   *Возвращает:* `{ "type": "coffee_point", "available": null }` или `{ "type": "meeting_room", "available": false, "userId": "1234", "nextAvailable": "2024-09-20T18:00:00Z" }`

24. **`GET /api/v1/workspaces/{workspaceId}/availability`** - Проверка доступности конкретного рабочего места
    *   *Возвращает:* `{ "available": true }` или `{ "available": false, "userId": "1234", "nextAvailable": "2024-09-20T18:00:00Z" }`


### 3. Бизнес-правила

1.  **Конфликт бронирований:** Система гарантирует, что одно и то же место не может быть забронировано двумя пользователями на пересекающиеся промежутки времени.
2.  **Продолжительность брони:** Максимальная продолжительность одного бронирования переговорной комнаты - 4 часа.
3.  **"Офисный день":** Бронирование на целый день (с 9:00 до 18:00) имеет приоритет и не может быть отменено автоматически из-за более коротких броней.
4.  **Автоматическое освобождение:** Если пользователь не отметился на месте в течение 30 минут после начала брони, система может автоматически освободить место (опциональная настройка офиса).

### 4. Бизнес-метрики успеха

1.  **Скорость ответа API:** 95% запросов к `/api/v1/workspaces/availability` и `/api/v1/rooms/availability` должны обрабатываться ≤ 500 мс.
2.  **Точность данных:** Актуальность статуса места на карте должна составлять ≥ 99.9% (задержка обновления ≤ 5 секунд).
3.  **Удовлетворенность пользователей:** ≥ 90% пользователей должны оценивать процесс бронирования как "простой и intuitive" (через встроенные опросы NPS/CSAT).
4.  **Ограничения частоты запросов (Rate Limiting):**
    *   Анонимные пользователи: 10 запросов/мин
    *   Авторизованные пользователи: 60 запросов/мин
    *   Администраторы: 200 запросов/мин
