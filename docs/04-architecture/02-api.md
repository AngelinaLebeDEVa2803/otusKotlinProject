# API Desk-Sharing приложения SmartOffice


### 1. Сущности

**Филиал (Filial)**

| Поле | Тип | Бизнес-описание | Пример значения |
| :--- | :--- | :--- | :--- |
| `filialId` | string | Уникальный идентификатор филиала | `"001"` |
| `name` | string | Человекочитаемое название филиала | `"Центральный офис"` |

**Здание (Building)**

| Поле | Тип | Бизнес-описание | Пример значения |
| :--- | :--- | :--- | :--- |
| `buildingId` | string | Уникальный идентификатор филиала | `"B1234"` |
| `address` | string | Адрес здания | `"Ромашковая 7"` |
| `filialId` | string | ID филиала, к которому принадлежит здание | `"001"` |

**Этаж (Floor)**

| Поле | Тип | Бизнес-описание | Пример значения |
| :--- | :--- | :--- | :--- |
| `floorId` | string | ID этажа | `"floor_2"` |
| `name` | string | Человекочитаемое обозначение этажа | `"Этаж 2"` |
| `filialId` | string | ID филиала, к которому принадлежит здание | `"001"` |
| `buildingId` | string | Id здания, к которому принадлежит этаж | `"B1234"` |
| `floorMap` | file | Изображение/карта этажа | `first_floor_picture.png` |


**Рабочее место (Workspace)**

| Поле | Тип | Бизнес-описание | Пример значения |
| :--- | :--- | :--- | :--- |
| `id` | string | Уникальный идентификатор места | `"ws_floor2_a205"` |
| `name` | string | Человекочитаемое название места | `"А-205"` |
| `type` | string | Тип: `"desk"`, `"meeting_room"` | `"desk"` |
| `filialId` | string | ID филиала, на котором находится место | `"001"` |
| `buildingId` | string | ID здания, на котором находится место | `"B1234"` |
| `floorId` | string | ID этажа, на котором находится место | `"floor_2"` |
| `coordinates` | object | Координаты на карте этажа (`x`, `y`) | `{ "x": 150, "y": 320 }` |
| `attributes` | string[] | Список атрибутов места | `["monitor", "window", "power_outlet"]` |
| `capacity` | integer | Вместимость для переговорных, для рабочего места = 1 | `5` |
| `status` | string | Текущий статус: `"active"`, `"inactive"`, `"under_maintenance"` | `"active"` |

**Бронирование (Booking)**

| Поле | Тип | Бизнес-описание | Пример значения |
| :--- | :--- | :--- | :--- |
| `id` | string | Уникальный идентификатор брони | `"book_abc123"` |
| `userId` | string | ID пользователя, создавшего бронь | `"user_789"` |
| `workspaceId` | string | ID забронированного места | `"ws_floor2_a205"` |
| `startTime` | ISO 8601 | Дата и время начала брони | `"2024-09-20T09:00:00Z"` |
| `endTime` | ISO 8601 | Дата и время окончания брони | `"2024-09-20T17:00:00Z"` |
| `status` | string | Статус: `"active"`, `"cancelled"`, `"completed"` | `"active"` |
| `guestInfo` | object | Информация о госте (опционально) | `{ "name": "Иван Петров", "email": "guest@company.com" }` |

### 2. Бизнес-функции (методы)

**Управление сущностями офиса. Сервис EditOffice**
1.  **`POST /api/v1/bookings`** - Создание нового бронирования
    *   *Бизнес-правило:* Пользователь не может забронировать уже занятое место на выбранный промежуток времени.
    *   *Ограничения:* Максимум 3 активных брони на пользователя вперед.
    *   *Тело запроса:* `{ workspaceId: "ws_floor2_a205", startTime: "2024-09-20T09:00:00Z", endTime: "2024-09-20T17:00:00Z" }`

2.  **`GET /api/v1/bookings/{id}`** - Получение информации о бронировании
    *   *Бизнес-правило:* Пользователь может видеть только свои брони или брони своей команды (если есть права).



**Управление бронированиями**
1.  **`POST /api/v1/bookings`** - Создание нового бронирования
    *   *Бизнес-правило:* Пользователь не может забронировать уже занятое место на выбранный промежуток времени.
    *   *Ограничения:* Максимум 3 активных брони на пользователя вперед.
    *   *Тело запроса:* `{ workspaceId: "ws_floor2_a205", startTime: "2024-09-20T09:00:00Z", endTime: "2024-09-20T17:00:00Z" }`

2.  **`GET /api/v1/bookings/{id}`** - Получение информации о бронировании
    *   *Бизнес-правило:* Пользователь может видеть только свои брони или брони своей команды (если есть права).

3.  **`GET /api/v1/bookings`** - Получение списка своих бронирований
    *   *Параметры:* `?userId=user_789&date=2024-09-20`
    *   *Бизнес-логика:* Возвращает бронирования пользователя на указанную дату.

4.  **`PATCH /api/v1/bookings/{id}`** - Обновление бронирования (например, изменение времени)
    *   *Бизнес-правило:* Изменение возможно только за 1 час до начала брони.

5.  **`DELETE /api/v1/bookings/{id}`** - Отмена бронирования
    *   *Бизнес-правило:* Отмена возможна в любое время до начала брони. После начала - только администратором.

**Поиск и доступность**
6.  **`GET /api/v1/workspaces/availability`** - Поиск свободных мест
    *   *Бизнес-логика:* Возвращает список мест, доступных для бронирования на указанный промежуток времени.
    *   *Параметры:* `?floorId=floor_2&startTime=2024-09-20T09:00:00Z&endTime=2024-09-20T17:00:00Z&attributes=monitor,window`
    *   *Фильтры:* По этажу, дате/времени, атрибутам места.

7.  **`GET /api/v1/workspaces/{id}/availability`** - Проверка доступности конкретного места
    *   *Возвращает:* `{ "available": true }` или `{ "available": false, "nextAvailable": "2024-09-20T18:00:00Z" }`

**Управление картой и администрирование**
8.  **`GET /api/v1/floors/{id}/map`** - Получение карты этажа
    *   *Возвращает:* SVG или JSON с данными о расположении всех мест на этаже и их текущим статусом.

9.  **`GET /api/v1/teams/{id}/presence`** - Просмотр присутствия команды
    *   *Бизнес-логика:* Возвращает список сотрудников команды, которые будут в офисе на указанную дату, и их места.
    *   *Параметры:* `?date=2024-09-20`

10. **`GET /api/v1/admin/analytics/usage`** - Получение аналитики использования (для администраторов)
    *   *Бизнес-логика:* Возвращает отчет о проценте использования (Utilization Rate) по этажам, зонам или всему офису.
    *   *Параметры:* `?startDate=2024-09-01&endDate=2024-09-20&granularity=daily` (`daily`, `weekly`, `monthly`)

### 3. Бизнес-правила

1.  **Конфликт бронирований:** Система гарантирует, что одно и то же место не может быть забронировано двумя пользователями на пересекающиеся промежутки времени.
2.  **Продолжительность брони:** Максимальная продолжительность одного бронирования переговорной комнаты - 4 часа.
3.  **"Офисный день":** Бронирование на целый день (с 9:00 до 18:00) имеет приоритет и не может быть отменено автоматически из-за более коротких броней.
4.  **Гостевой доступ:** Бронирование для гостя требует обязательного указания ФИО и email гостя. За день до визита гостю автоматически отправляется приглашение с QR-кодом.
5.  **Автоматическое освобождение:** Если пользователь не отметился на месте в течение 30 минут после начала брони, система может автоматически освободить место (опциональная настройка офиса).

### 4. Бизнес-метрики успеха

1.  **Скорость ответа API:** 95% запросов к `/api/v1/workspaces/availability` должны обрабатываться ≤ 500 мс.
2.  **Точность данных:** Актуальность статуса места на карте должна составлять ≥ 99.9% (задержка обновления ≤ 5 секунд).
3.  **Удовлетворенность пользователей:** ≥ 90% пользователей должны оценивать процесс бронирования как "простой и intuitive" (через встроенные опросы NPS/CSAT).
4.  **Эффективность использования пространства:** Целевой показатель Utilization Rate офиса - 60-80%.
5.  **Ограничения частоты запросов (Rate Limiting):**
    *   Анонимные пользователи: 10 запросов/мин
    *   Авторизованные пользователи: 60 запросов/мин
    *   Администраторы: 200 запросов/мин
