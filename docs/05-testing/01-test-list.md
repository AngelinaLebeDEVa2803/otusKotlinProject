### Тестовые сценарии для Desk-Sharing приложения

#### **FR-002: Бронирование рабочего места**
| **Test ID** | T-DS-001 |
| :--- | :--- |
| **Requirement** | FR-002 |
| **Scenario** | Успешное бронирование свободного рабочего места на текущий день |
| **Preconditions** | 1. Пользователь авторизован в системе через корпоративный аккаунт (SSO).<br>2. Место А-205 свободно на текущую дату. |
| **Test Steps** | **Given:** Пользователь открывает карту офиса на текущий день<br>**When:** Пользователь кликает на место А-205 (подсвечено зеленым) и нажимает "Забронировать"<br>**Then:** Система отображает попап с подтверждением брони, отправляет push-уведомление и создает событие в календаре пользователя. Статус места на карте меняется на "Забронировано" (желтый). |
| **Test Data** | Пользователь: test_user<br>Место: А-205<br>Дата: [Текущая дата] |
| **Pass Criteria** | 1. Бронь подтверждена системой.<br>2. Событие с правильным названием ("Место А-205") появилось в календаре пользователя в течение 3 минут.<br>3. Статус места на карте изменился визуально. |
| **Environment** | STAGING (Chrome 116, интеграция с Google Calendar) |

---

#### **FR-003: Просмотр присутствия коллег**
| **Test ID** | T-DS-002 |
| :--- | :--- |
| **Requirement** | FR-003 |
| **Scenario** | Фильтрация карты офиса для отображения только членов своей команды |
| **Preconditions** | 1. Пользователь авторизован и состоит в команде "Разработка".<br>2. На завтра есть 3 брони от членов команды "Разработка" и 5 броней от других сотрудников. |
| **Test Steps** | **Given:** Пользователь открывает карту офиса на завтрашний день<br>**When:** Пользователь активирует фильтр "Моя команда"<br>**Then:** Система скрывает все брони, кроме тех, что сделаны членами команды "Разработка". На карте остаются подсвеченными только 3 места. При наведении курсора отображаются имя и фото сотрудника. |
| **Test Data** | Команда: Разработка (5 человек)<br>Дата: [Завтрашняя дата]<br>Брони команды: места Б-101, Б-102, Б-103 |
| **Pass Criteria** | 1. На карте отображаются ровно 3 места.<br>2. Все отображенные сотрудники принадлежат к команде "Разработка".<br>3. Фотографии и имена сотрудников загружены и отображаются корректно. |
| **Environment** | STAGING (Chrome 116) |

---

#### **FR-007: Администрирование офисной карты**
| **Test ID** | T-DS-003 |
| :--- | :--- |
| **Requirement** | FR-007 |
| **Scenario** | Добавление нового рабочего места на карту офиса администратором |
| **Preconditions** | 1. Пользователь авторизован с ролью "Администратор".<br>2. Открыта админ-панель управления картой офиса. |
| **Test Steps** | **Given:** Администратор выбирает этаж 2 на карте офиса<br>**When:** Администратор перетаскивает новый элемент "Рабочее место" из панели инструментов в свободную зону на плане и присваивает ему номер "Б-205"<br>**Then:** Система сохраняет изменения. Новое место "Б-205" немедленно появляется на карте офиса для всех пользователей и доступно для бронирования. |
| **Test Data** | Этаж: 2<br>Новый ID места: Б-205<br>Координаты на плане: X:150, Y:320 |
| **Pass Criteria** | 1. Новое место появилось на карте в указанных координатах.<br>2. Место имеет статус "Свободно".<br>3. Обычный пользователь может найти и забронировать это место. |
| **Environment** | DEV (Режим администрирования) |

---

#### **PERF-001: Скорость загрузки карты офиса**
| **Test ID** | T-DS-004 |
| :--- | :--- |
| **Requirement** | PERF-001 |
| **Scenario** | Загрузка карты офиса под нагрузкой (пиковое время в понедельник утром) |
| **Preconditions** | 1. Развернута тестовая среда с актуальным планом офиса (3 этажа, 150 мест).<br>2. Настройка инструмента нагрузочного тестирования (k6). |
| **Test Steps** | **Given:** Настройка сценария k6: 50 виртуальных пользователей (VUs) с пиком до 100 VUs<br>**When:** Запуск теста на получение данных карты офиса и статусов мест<br>**Then:** 95% запросов завершаются ≤ 1.5 сек. Ошибок 0%. |
| **Test Data** | Этаж: 2 (50 рабочих мест)<br>Количество запросов: 1000 RPM (запросов в минуту) |
| **Pass Criteria** | 1. p95 latency ≤ 1500 мс.<br>2. Error rate = 0%.<br>3. Потребление CPU сервера приложения ≤ 70%. |
| **Environment** | Load Testing Zone (Yandex.Cloud) |

---

#### **FR-015 / SEC-005: Аутентификация через Keycloak**
| **Test ID** | T-DS-005A |
| :--- | :--- |
| **Requirement** | FR-015, SEC-005 |
| **Scenario** | Успешный вход пользователя в приложение через Keycloak (корпоративный Identity Provider) |
| **Preconditions** | 1. Пользователь имеет активную учетную запись в реалме Keycloak.<br>2. Приложение (client) зарегистрировано в Keycloak и сконфигурировано для использования потока авторизации Code Flow с PKCE.<br>3. В настройках пользователя в Keycloak заполнены атрибуты: `firstName`, `lastName`, `department`. |
| **Test Steps** | **Given:** Пользователь открывает главную страницу приложения<br>**When:** Пользователь нажимает кнопку **"Войти"**<br>**Then:** Система перенаправляет браузер на страницу авторизации Keycloak.<br><br>**When:** Пользователь вводит логин (`test_user`), пароль (`ValidPassword123!`) и нажимает **"Sign In"**<br>**Then:** Keycloak перенаправляет браузер обратно в приложение по указанному `redirect_uri`. Приложение обменивает `authorization_code` на `access_token`, `id_token` и `refresh_token`.<br><br>**Then:** Приложение декодирует JWT `id_token`, извлекает claims (preferred_username, given_name, department) и отображает главную страницу с именем и аватаром пользователя. |
| **Test Data** | **Keycloak Realm:** `my-company-realm`<br>**Client ID:** `desk-sharing-app`<br>**User Credentials:**<br> - Логин: `test_user`<br> - Пароль: `ValidPassword123!`<br>**User Attributes in Keycloak:**<br> - firstName: `Иван`<br> - lastName: `Петров`<br> - department: `Разработка` |
| **Pass Criteria** | 1. Произошел редирект на страницу Keycloak (`/auth/realms/my-company-realm/protocol/openid-connect/auth`).<br>2. После ввода данных пользователь перенаправлен обратно в приложение.<br>3. Приложение получило и корректно декодировало `id_token` (JWT).<br>4. На главной странице отображается приветствие: **"Добро пожаловать, Иван Петров (Разработка)"**.<br>5. В логах Keycloak и приложения отсутствуют ошибки аутентификации (коды 4xx, 5xx).<br>6. Трафик между приложением и Keycloak шифруется (TLS 1.3+). |
| **Environment** | STAGING (Keycloak v22+, настроенный реалм `my-company-realm-staging`) |

---
4.  **Производительность** под нагрузкой (T-DS-004)
5.  **Безопасность и аутентификация** (T-DS-005)
